{% extends "base.html" %}

{% block content %}
<div class="analyzer-container">
    <div class="alert alert-info">
        <h5><i class="fas fa-shield-alt me-2"></i>Privacy First</h5>
        <p class="mb-0">All captured frames are encrypted and stored securely. You can delete your data anytime from <a href="{{ url_for('privacy.data_settings') }}">Privacy Settings</a>.</p>
    </div>

    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-video"></i> Screen Recording Analyzer</h3>
                    <p class="text-muted">Analyze your screen activity in real-time</p>
                </div>
                <div class="card-body">
                    <div class="analyzer-controls">
                        <input type="text" id="sessionName" class="form-control mb-3" placeholder="Session Name (optional)">
                        <button id="startBtn" class="btn btn-success btn-lg" onclick="showConsentModal()">
                            <i class="fas fa-play"></i> Start Recording & Analysis
                        </button>
                        <button id="stopBtn" class="btn btn-danger btn-lg" style="display: none;">
                            <i class="fas fa-stop"></i> Stop Analysis
                        </button>
                    </div>

                    <div id="recordingStatus" class="mt-4" style="display: none;">
                        <div class="alert alert-info">
                            <i class="fas fa-circle text-danger blink"></i> Recording in progress...
                            <span id="recordingTime">00:00</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" id="analysisProgress" style="width: 0%"></div>
                        </div>
                        <p class="mt-2">Frames analyzed: <span id="framesAnalyzed">0</span></p>
                    </div>

                    <div id="liveResults" class="mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="resultsSection" style="display: none;">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h4>Session Summary</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="result-stat">
                                <h3 id="resultWellness">0</h3>
                                <p>Wellness Score</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="result-stat">
                                <h3 id="resultProductivity">0</h3>
                                <p>Productivity Score</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="result-stat">
                                <h3 id="resultFrames">0</h3>
                                <p>Frames Analyzed</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="result-stat">
                                <h3 id="resultDuration">0s</h3>
                                <p>Duration</p>
                            </div>
                        </div>
                    </div>
                    <a href="{{ url_for('dashboard.index') }}" class="btn btn-primary mt-3">
                        <i class="fas fa-chart-line"></i> View in Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="consentModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i>Recording Consent & Privacy Notice</h5>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>IMPORTANT: Please Read Before Recording</h6>
                </div>

                <h6 class="mt-3"><i class="fas fa-info-circle me-2 text-primary"></i>What happens when you record:</h6>
                <ul>
                    <li>Frames are captured from your screen every {{ config.FRAME_EXTRACTION_RATE }} seconds</li>
                    <li>Each frame is <strong>encrypted using AES-256</strong> before storage</li>
                    <li>Frames are sent to <strong>OpenAI's GPT-4 Vision API</strong> for analysis</li>
                    <li>Analysis includes: app detection, content type, sentiment, and text extraction</li>
                    <li>All data is stored securely on our servers, <strong>never sold</strong></li>
                </ul>

                <h6 class="mt-3"><i class="fas fa-lock me-2 text-success"></i>Your Privacy is Protected:</h6>
                <ul class="text-success">
                    <li>✓ End-to-end encryption for all captured frames</li>
                    <li>✓ Automatic deletion of frames older than 30 days</li>
                    <li>✓ You can delete all data anytime from Privacy Settings</li>
                    <li>✓ No third-party tracking or advertising</li>
                </ul>

                <h6 class="mt-3"><i class="fas fa-user-check me-2 text-primary"></i>Your Responsibilities:</h6>
                <ul>
                    <li>You have the legal right to record the content on your screen</li>
                    <li>You will not record others' screens without their consent</li>
                    <li>You will not record copyrighted content you don't own</li>
                    <li>You will not record sensitive financial or confidential information</li>
                </ul>

                <h6 class="mt-3"><i class="fas fa-share-alt me-2 text-info"></i>Third-Party Sharing:</h6>
                <p>By clicking "I Agree", you acknowledge that:</p>
                <ul>
                    <li>Frames will be sent to <a href="https://openai.com" target="_blank">OpenAI</a> for AI analysis</li>
                    <li>OpenAI's <a href="https://openai.com/privacy" target="_blank">Privacy Policy</a> and <a href="https://openai.com/terms" target="_blank">Terms</a> apply to this data</li>
                    <li>We are not responsible for OpenAI's data practices</li>
                </ul>

                <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" id="consentCheckbox">
                    <label class="form-check-label" for="consentCheckbox">
                        <strong>I have read and agree to the above terms. I confirm that I have the legal right to record this content and consent to processing by OpenAI.</strong>
                    </label>
                </div>

                <p class="small text-muted mt-3">
                    <i class="fas fa-file-contract me-1"></i>
                    By using this service, you also agree to our <a href="{{ url_for('privacy.terms') }}" target="_blank">Terms of Service</a> and <a href="{{ url_for('privacy.policy') }}" target="_blank">Privacy Policy</a>.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="acceptConsentBtn" disabled onclick="startRecordingWithConsent()">
                    <i class="fas fa-check me-2"></i>I Agree - Start Recording
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('consentCheckbox').addEventListener('change', function() {
    document.getElementById('acceptConsentBtn').disabled = !this.checked;
});

function showConsentModal() {
    const consentModal = new bootstrap.Modal(document.getElementById('consentModal'));
    consentModal.show();
}

function startRecordingWithConsent() {
    const consentModal = bootstrap.Modal.getInstance(document.getElementById('consentModal'));
    consentModal.hide();

    if (typeof startRecording === 'function') {
        startRecording();
    }
}
</script>

<script src="{{ url_for('static', filename='js/analyzer.js') }}"></script>
{% endblock %}
