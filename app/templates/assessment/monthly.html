{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">
                    <h4 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Monthly Wellness Assessment</h4>
                    <small>Deeper reflection on your month</small>
                </div>
                <div class="card-body">
                    {% if existing %}
                    <div class="alert alert-info">
                        <i class="fas fa-check-circle me-2"></i>
                        You've already completed this month's assessment. You can update your responses below.
                    </div>
                    {% endif %}

                    <form method="POST" id="monthlyForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                        <div class="progress mb-4" style="height: 8px;">
                            <div class="progress-bar bg-purple" id="formProgress" style="width: 0%; background: linear-gradient(90deg, #6366f1, #8b5cf6);"></div>
                        </div>

                        {% for question in questions %}
                        <div class="question-card mb-4 p-3 border rounded" data-question="{{ loop.index }}">
                            <p class="fw-bold mb-3">{{ loop.index }}. {{ question.text }}</p>
                            <div class="rating-scale d-flex justify-content-between">
                                {% for i in range(1, 6) %}
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio"
                                           name="{{ question.id }}" id="{{ question.id }}_{{ i }}"
                                           value="{{ i }}" required
                                           {% if existing and existing.get_responses().get(question.id) == i %}checked{% endif %}>
                                    <label class="form-check-label" for="{{ question.id }}_{{ i }}">
                                        {% if i == 1 %}Very Poor
                                        {% elif i == 2 %}Poor
                                        {% elif i == 3 %}Average
                                        {% elif i == 4 %}Good
                                        {% else %}Excellent{% endif %}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-lg px-5" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white;">
                                <i class="fas fa-check me-2"></i>Complete Assessment
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="text-center mt-3">
                <a href="{{ url_for('assessment.history') }}" class="text-muted">
                    <i class="fas fa-history me-1"></i>View Assessment History
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.question-card {
    background: #f8f9fa;
    transition: all 0.3s;
}
.question-card:hover {
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.form-check-input:checked {
    background-color: #6366f1;
    border-color: #6366f1;
}
.rating-scale {
    flex-wrap: wrap;
    gap: 10px;
}
@media (max-width: 768px) {
    .rating-scale {
        flex-direction: column;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('monthlyForm');
    const progress = document.getElementById('formProgress');
    const totalQuestions = {{ questions|length }};

    form.addEventListener('change', function() {
        const answered = form.querySelectorAll('input[type="radio"]:checked').length;
        const percent = (answered / totalQuestions) * 100;
        progress.style.width = percent + '%';
    });
});
</script>
{% endblock %}
